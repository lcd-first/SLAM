# 多传感器定位

# 日志

- 5月8号    4节课 



# 资料： 

```
github 作业分享 
https://github.com/zhouyong1234/Multi-Sensor-Fusion
https://github.com/kahowang/sensor-fusion-for-localization-and-mapping/tree/main

csdn 作业分享
https://blog.csdn.net/hitljy/article/details/109227799?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522171517310016800184168083%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=171517310016800184168083&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-109227799-null-null.142^v100^pc_search_result_base4&utm_term=%E5%A4%9A%E4%BC%A0%E6%84%9F%E5%99%A8%E8%9E%8D%E5%90%88%E5%AE%9A%E4%BD%8D%E4%BD%9C%E4%B8%9A&spm=1018.2226.3001.4449

课程讲师，知乎教程
https://zhuanlan.zhihu.com/c_1114864226103037952
以及配套github代码
https://github.com/Little-Potato-1990/localization_in_auto_driving
```



![image-20240508175513190](D:\SLAM\多传感器融合定位课程学习\多传感器定位笔记.assets\image-20240508175513190.png)



# 1. 3D激光里程计



## 1. 激光传感器原理





## 2. 整理流程介绍

![image-20240508180118984](D:\SLAM\多传感器融合定位课程学习\多传感器定位笔记.assets\image-20240508180118984.png)















## 3. 前端里程计方案

- 对前端要求不高，但要求有足够的平滑性

![image-20240508180524147](D:\SLAM\多传感器融合定位课程学习\多传感器定位笔记.assets\image-20240508180524147.png)

### 1. 前端里程计-直接匹配

#### 1. ICP- 点到点

![image-20240508181044834](D:\SLAM\多传感器融合定位课程学习\多传感器定位笔记.assets\image-20240508181044834.png)



- 怎样让两段点云重合

- 以及如何评价两端点云的重合情况  

  - 所有点都是重合的 - 最理想
  - 过滤一下 用两段点云中都存在的点为对应点进行匹配  采样  随机采样  平均采样  
  - 是否匹配的好，就是点与点之间的距离 距离越近 匹配越好

- 求对应点 关联  迭代

  - 求两端点云A，B， 求A 点云中一个点，和B点云中某点距离最短的一个点，注意：最近点不一定是想要的点，所以才进行迭代
  - 求解位姿，将新的位姿加进去，在求解一次最近点，得到位姿，再加进去，直到两个点云完全重合

- icp 缺点

  - 在计算关联点时，通过得出的位姿，计算下一次关联点时，计算的新的关联点可能比上一次的关联点还不准，关联点的距离还会更远

  - 需要准确的初始位姿

![image-20240508184521299](D:\SLAM\多传感器融合定位课程学习\多传感器定位笔记.assets\image-20240508184521299.png)

#### 2. NDT 

![image-20240508184722344](D:\SLAM\多传感器融合定位课程学习\多传感器定位笔记.assets\image-20240508184722344.png)



优点

- 鲁棒性更强
- 计算量小

思想

- 将A点云划分为栅格 ，每个栅格中有很多点 ，这些点会有一种分布 均值  方差 
- B点云也有一个分布，不划分栅格 ，A和B 都有一个初始位姿，将B点云 通过旋转平移到A点云，B点云会落到A的栅格里
- 若A点云和B点云的在A的栅格中的分布相同或接近，则认为匹配成功



![image-20240508203743623](D:\SLAM\多传感器融合定位课程学习\多传感器定位笔记.assets\image-20240508203743623.png)



![image-20240508204330028](D:\SLAM\多传感器融合定位课程学习\多传感器定位笔记.assets\image-20240508204330028.png)

![image-20240508204439332](D:\SLAM\多传感器融合定位课程学习\多传感器定位笔记.assets\image-20240508204439332.png)







![image-20240508204711423](D:\SLAM\多传感器融合定位课程学习\多传感器定位笔记.assets\image-20240508204711423.png)



### 2. 前端里程计方案-基于特征



![image-20240508211403128](D:\SLAM\多传感器融合定位课程学习\多传感器定位笔记.assets\image-20240508211403128.png)



- 精度 和 效率 高

工作思路：

- 提取特征
  - 按线数分割
  - 计算曲率
  - 删除异常点
  - 按照曲率大小筛选特征点
    - 曲率特别大的点 sharp
    - 曲率大的点 lsee_shap
    - 曲率特别小的点  flat
    - 曲率小的点 less_flat
- 帧间匹配
  - 特征关联与损失函数计算
    - 线特征
    - 面特征
  - LM迭代优化
- 构建地图
  - 合并地图点
    - 把关键帧的特征点按照位姿转到地图坐标系中
    - 按照位置和cube尺寸划分到对应的cube中
  - 位姿优化与里程计的方法同理

- ALOAM 主要特点
  - 取消了和imu相关的部分
  - 使用eigen库 做位姿变换，简化了代码
  - 使用ceres 库做迭代优化，简化了代码，但降低了效率
- FLOAM
  - 整体和ALOAM类似，只是把ceres中的自动求导，转变成了直接使用推导的雅可比矩阵 
- LEGO-LOAM
  - 主要特点
    - 对地面做了分割，减小了特征搜索范围
    - 提取特征之前做了聚类，提高了特征质量
    - 水平和航向分别优化，提高了效率
  - 特征提取
    - 根据线与线之间的夹角，以及点的曲率，筛选出地面点，所有用于匹配的平面点仅使用地面点
    - 在非地面点中，使用广度优先搜索（BFS）做聚类，聚类中点的数量大于30，才用来筛选线特征
    - 筛选线特征方法，与LOAM中相同
  - 里程计
    - 使用地面面特征优化高度和水平角
    - 使用线特征优化水平位移和航线角
    - 具体推导过程，可根据LOAM 中的六自由度方法，重新推导此处三自由度方法 





## 4. 基于数据集实现

### 1. KITTI 数据集简介

硬件组成

1. 一个64线激光雷达， 在车顶的正中心
2. 两个彩色摄像头和两个黑白摄像头，在雷达两侧
3. 一个组合导航系统（OXTS RT 3003），在雷达左后方，它可以输出RTK/IMU组合导航结果，包括经纬度和姿态，同时也输出IMU原始数据

![image-20240508220611444](D:\SLAM\多传感器融合定位课程学习\多传感器定位笔记.assets\image-20240508220611444.png)



安装关系，在标定文件中可以找到



![image-20240508220643724](D:\SLAM\多传感器融合定位课程学习\多传感器定位笔记.assets\image-20240508220643724.png)





### 2. 数据集的使用



![image-20240508220748574](D:\SLAM\多传感器融合定位课程学习\多传感器定位笔记.assets\image-20240508220748574.png)

![image-20240508220842944](D:\SLAM\多传感器融合定位课程学习\多传感器定位笔记.assets\image-20240508220842944.png)





### 3. 里程计工程框架实现

核心思想：

1. 通过类封装，实现模块化
2. 把ros流程和C++ 内部分开，使流程清晰
3. 基于c++ 多态，实现高可扩展性

![image-20240508221714129](D:\SLAM\多传感器融合定位课程学习\多传感器定位笔记.assets\image-20240508221714129.png)

具体参考讲师知乎专栏



### 4. 里程计精度评价

以组合惯导的结果为真值，使用evo工具进行里程计精度评价

![image-20240508222027326](D:\SLAM\多传感器融合定位课程学习\多传感器定位笔记.assets\image-20240508222027326.png)















